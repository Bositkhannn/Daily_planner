<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Daily Planner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        :root {
            /* Neutral Theme (Default) */
            --primary: #7c3aed;
            --primary-light: #a78bfa;
            --primary-dark: #5b21b6;
            --secondary: #10b981;
            --secondary-light: #34d399;
            --accent: #f59e0b;
            --accent-light: #fbbf24;
            --background: #f8fafc;
            --surface: #ffffff;
            --surface-light: #f1f5f9;
            --text: #1e293b;
            --text-light: #64748b;
            --text-lighter: #94a3b8;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.08);
            --shadow-hover: rgba(0, 0, 0, 0.12);
            --gradient: linear-gradient(135deg, #7c3aed, #10b981);
            --gradient-light: linear-gradient(135deg, #a78bfa, #34d399);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            
            /* Mobile-first sizing */
            --font-size-sm: 14px;
            --font-size-base: 16px;
            --font-size-lg: 18px;
            --font-size-xl: 20px;
            --font-size-2xl: 24px;
            --font-size-3xl: 32px;
            
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            
            --border-radius-sm: 8px;
            --border-radius: 12px;
            --border-radius-lg: 16px;
            
            --touch-target: 44px;
        }

        body.masculine {
            --primary: #2563eb;
            --primary-light: #60a5fa;
            --primary-dark: #1d4ed8;
            --secondary: #059669;
            --secondary-light: #10b981;
            --accent: #d97706;
            --accent-light: #f59e0b;
            --background: #f0f9ff;
            --surface: #ffffff;
            --surface-light: #e0f2fe;
            --text: #0f172a;
            --text-light: #475569;
            --text-lighter: #94a3b8;
            --border: #cbd5e1;
            --shadow: rgba(0, 0, 0, 0.1);
            --shadow-hover: rgba(0, 0, 0, 0.15);
            --gradient: linear-gradient(135deg, #2563eb, #059669);
            --gradient-light: linear-gradient(135deg, #60a5fa, #10b981);
            --success: #059669;
            --warning: #d97706;
            --error: #dc2626;
        }

        body.feminine {
            --primary: #db2777;
            --primary-light: #f472b6;
            --primary-dark: #be185d;
            --secondary: #7e22ce;
            --secondary-light: #a855f7;
            --accent: #ea580c;
            --accent-light: #f97316;
            --background: #fdf2f8;
            --surface: #ffffff;
            --surface-light: #fce7f3;
            --text: #581c87;
            --text-light: #a855f7;
            --text-lighter: #c084fc;
            --border: #fbcfe8;
            --shadow: rgba(219, 39, 119, 0.1);
            --shadow-hover: rgba(219, 39, 119, 0.2);
            --gradient: linear-gradient(135deg, #db2777, #7e22ce);
            --gradient-light: linear-gradient(135deg, #f472b6, #a855f7);
            --success: #7e22ce;
            --warning: #ea580c;
            --error: #e11d48;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            transition: all 0.5s ease;
            min-height: 100vh;
            overflow-x: hidden;
            font-size: var(--font-size-base);
            line-height: 1.5;
        }

        .app-container {
            max-width: 100%;
            margin: 0 auto;
            padding: var(--spacing-sm);
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-lg) var(--spacing-md);
            background: var(--gradient);
            color: white;
            border-radius: var(--border-radius-lg);
            box-shadow: 0 4px 12px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        header h1 {
            font-size: var(--font-size-2xl);
            margin-bottom: var(--spacing-sm);
            font-weight: 700;
        }

        .date-navigation {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-sm);
        }

        .date-navigation button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: var(--spacing-sm);
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: var(--font-size-lg);
            transition: all 0.3s ease;
            min-width: var(--touch-target);
            min-height: var(--touch-target);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .date-navigation button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .date-display {
            font-size: var(--font-size-lg);
            font-weight: 600;
            min-width: 200px;
        }

        /* Theme Selector */
        .theme-selector {
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            display: flex;
            gap: var(--spacing-xs);
        }

        .theme-btn {
            width: var(--touch-target);
            height: var(--touch-target);
            border-radius: 50%;
            border: 2px solid white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--font-size-sm);
        }

        .theme-btn.active {
            transform: scale(1.1);
            box-shadow: 0 0 0 2px white;
        }

        .theme-btn.neutral {
            background: linear-gradient(135deg, #7c3aed, #10b981);
        }

        .theme-btn.masculine {
            background: linear-gradient(135deg, #2563eb, #059669);
        }

        .theme-btn.feminine {
            background: linear-gradient(135deg, #db2777, #7e22ce);
        }

        /* Main Planner Layout */
        .planner-container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        /* Section Common Styles */
        section {
            background: var(--surface);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--surface-light);
        }

        .section-header h2 {
            color: var(--primary);
            font-size: var(--font-size-xl);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .action-btn {
            background: var(--surface-light);
            border: none;
            color: var(--text-light);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: var(--touch-target);
            min-height: var(--touch-target);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Input Areas */
        .input-area {
            display: flex;
            margin-bottom: var(--spacing-md);
            gap: var(--spacing-xs);
        }

        .input-area input {
            flex-grow: 1;
            padding: var(--spacing-md);
            border: 2px solid var(--border);
            border-radius: var(--border-radius);
            font-size: var(--font-size-base);
        }

        .add-btn {
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            min-width: var(--touch-target);
            min-height: var(--touch-target);
        }

        /* List Styles */
        .task-list, .habit-list {
            list-style: none;
            margin-bottom: var(--spacing-md);
            max-height: 300px;
            overflow-y: auto;
        }

        .task-item, .habit-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-xs);
            border-radius: var(--border-radius);
            background: var(--surface-light);
            border-left: 4px solid transparent;
        }

        .task-item input[type="checkbox"], .habit-item input[type="checkbox"] {
            margin-right: var(--spacing-md);
            transform: scale(1.3);
            cursor: pointer;
            accent-color: var(--primary);
        }

        .task-item span, .habit-item span {
            flex-grow: 1;
            font-size: var(--font-size-base);
            font-weight: 500;
            word-break: break-word;
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--error);
            font-size: var(--font-size-lg);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--border-radius-sm);
            min-width: var(--touch-target);
            min-height: var(--touch-target);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Completed items */
        .task-item.completed {
            background: var(--success);
            color: white;
            border-left-color: var(--secondary);
        }

        .task-item.completed span {
            text-decoration: line-through;
        }

        .habit-item.checked {
            background: var(--primary-light);
            color: white;
            border-left-color: var(--primary);
        }

        /* Stats */
        .stats {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: var(--spacing-sm);
            padding: var(--spacing-md);
            background: var(--surface-light);
            border-radius: var(--border-radius);
            margin-top: var(--spacing-md);
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-weight: 600;
            color: var(--text-light);
            font-size: var(--font-size-sm);
        }

        .stat-item.streak {
            color: var(--accent);
            font-weight: 700;
        }

        /* Calendar Styles */
        .calendar {
            background: var(--surface);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
        }

        .calendar-header button {
            background: var(--gradient);
            border: none;
            color: white;
            padding: var(--spacing-sm);
            border-radius: var(--border-radius);
            cursor: pointer;
            min-width: var(--touch-target);
            min-height: var(--touch-target);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-header h3 {
            color: var(--primary);
            font-weight: 600;
            font-size: var(--font-size-lg);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day {
            padding: var(--spacing-sm) 4px;
            text-align: center;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 600;
            font-size: var(--font-size-sm);
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-day.header {
            font-weight: 700;
            color: var(--primary);
            background: var(--surface-light);
            cursor: default;
        }

        .calendar-day.other-month {
            color: var(--text-lighter);
            background: var(--surface-light);
            opacity: 0.5;
        }

        .calendar-day.today {
            background: var(--gradient);
            color: white;
        }

        .calendar-day.has-tasks {
            background: var(--accent-light);
            color: white;
        }

        .calendar-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-sm);
        }

        .stat-card {
            background: var(--gradient);
            color: white;
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            text-align: center;
        }

        .stat-icon {
            font-size: var(--font-size-2xl);
            margin-bottom: var(--spacing-xs);
        }

        .stat-number {
            display: block;
            font-size: var(--font-size-xl);
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
        }

        .stat-label {
            font-size: var(--font-size-sm);
        }

        /* Motivational Quote */
        .motivational-quote {
            text-align: center;
            padding: var(--spacing-lg);
            margin-top: var(--spacing-xl);
            background: var(--gradient);
            color: white;
            border-radius: var(--border-radius-lg);
        }

        /* Responsive Design */
        @media (min-width: 768px) {
            .app-container {
                padding: var(--spacing-lg);
                max-width: 1200px;
            }
            
            .planner-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: var(--spacing-xl);
            }
            
            .stats {
                flex-wrap: nowrap;
            }
        }

        @media (max-width: 360px) {
            .input-area {
                flex-direction: column;
            }
            
            .stats {
                flex-direction: column;
                align-items: center;
            }
            
            .calendar-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="neutral">
    <div class="app-container">
        <header>
            <div class="theme-selector">
                <button class="theme-btn neutral active" data-theme="neutral" title="Neutral Theme">
                    <i class="fas fa-palette"></i>
                </button>
                <button class="theme-btn masculine" data-theme="masculine" title="Masculine Theme">
                    <i class="fas fa-mountain"></i>
                </button>
                <button class="theme-btn feminine" data-theme="feminine" title="Feminine Theme">
                    <i class="fas fa-heart"></i>
                </button>
            </div>
            
            <h1>Smart Daily Planner</h1>
            <div class="date-navigation">
                <button id="prev-day">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="date-display" id="current-date"></div>
                <button id="next-day">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </header>

        <main class="planner-container">
            <section class="todo-section">
                <div class="section-header">
                    <h2><i class="fas fa-tasks"></i> Today's Tasks</h2>
                    <div class="section-actions">
                        <button class="action-btn" id="clear-completed-tasks" title="Clear Completed">
                            <i class="fas fa-broom"></i>
                        </button>
                    </div>
                </div>
                
                <div class="input-area">
                    <input type="text" id="task-input" placeholder="What needs to be done?" maxlength="100">
                    <button id="add-task-btn" class="add-btn">
                        <i class="fas fa-plus"></i> Add Task
                    </button>
                </div>
                
                <ul class="task-list" id="task-list"></ul>
                
                <div class="stats">
                    <span class="stat-item">
                        <i class="fas fa-list-check"></i>
                        Total: <span id="task-count">0</span>
                    </span>
                    <span class="stat-item">
                        <i class="fas fa-check-circle"></i>
                        Done: <span id="completed-count">0</span>
                    </span>
                    <span class="stat-item">
                        <i class="fas fa-clock"></i>
                        Pending: <span id="pending-count">0</span>
                    </span>
                </div>
            </section>

            <section class="habit-section">
                <div class="section-header">
                    <h2><i class="fas fa-fire"></i> Daily Habits</h2>
                    <div class="section-actions">
                        <button class="action-btn" id="reset-habits" title="Reset Today's Habits">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                </div>
                
                <div class="input-area">
                    <input type="text" id="habit-input" placeholder="Add a new habit..." maxlength="50">
                    <button id="add-habit-btn" class="add-btn">
                        <i class="fas fa-plus"></i> Add Habit
                    </button>
                </div>
                
                <ul class="habit-list" id="habit-list"></ul>
                
                <div class="stats">
                    <span class="stat-item">
                        <i class="fas fa-calendar-check"></i>
                        Completed: <span id="habits-completed">0</span>/<span id="habits-total">0</span>
                    </span>
                    <span class="stat-item streak">
                        <i class="fas fa-bolt"></i>
                        Streak: <span id="streak-count">0</span> days
                    </span>
                </div>
            </section>
        </main>

        <section class="calendar-section">
            <div class="section-header">
                <h2><i class="fas fa-calendar-alt"></i> Calendar Overview</h2>
            </div>
            
            <div class="calendar" id="calendar">
                <div class="calendar-header">
                    <button id="prev-month">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h3 id="current-month"></h3>
                    <button id="next-month">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="calendar-grid" id="calendar-grid"></div>
            </div>
            
            <div class="calendar-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-number" id="month-completed">0</span>
                        <span class="stat-label">Tasks Completed</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-fire"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-number" id="month-streak">0</span>
                        <span class="stat-label">Best Streak</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-number" id="month-percentage">0%</span>
                        <span class="stat-label">Completion Rate</span>
                    </div>
                </div>
            </div>
        </section>

        <div class="motivational-quote">
            <p id="quote-text">"The secret of getting ahead is getting started."</p>
            <span id="quote-author">- Mark Twain</span>
        </div>
    </div>

    <script>
        class SmartPlanner {
            constructor() {
                this.currentDate = new Date();
                this.tasks = this.loadData('tasks') || {};
                this.habits = this.loadData('habits') || [];
                this.habitHistory = this.loadData('habitHistory') || {};
                this.quotes = this.getMotivationalQuotes();
                
                this.initializeElements();
                this.setupEventListeners();
                this.setupThemeSelector();
                this.render();
                this.showRandomQuote();
            }

            initializeElements() {
                // Date elements
                this.currentDateEl = document.getElementById('current-date');
                this.prevDayBtn = document.getElementById('prev-day');
                this.nextDayBtn = document.getElementById('next-day');
                
                // Task elements
                this.taskInput = document.getElementById('task-input');
                this.addTaskBtn = document.getElementById('add-task-btn');
                this.taskList = document.getElementById('task-list');
                this.taskCount = document.getElementById('task-count');
                this.completedCount = document.getElementById('completed-count');
                this.pendingCount = document.getElementById('pending-count');
                this.clearCompletedBtn = document.getElementById('clear-completed-tasks');
                
                // Habit elements
                this.habitInput = document.getElementById('habit-input');
                this.addHabitBtn = document.getElementById('add-habit-btn');
                this.habitList = document.getElementById('habit-list');
                this.habitsCompleted = document.getElementById('habits-completed');
                this.habitsTotal = document.getElementById('habits-total');
                this.streakCount = document.getElementById('streak-count');
                this.resetHabitsBtn = document.getElementById('reset-habits');
                
                // Calendar elements
                this.currentMonthEl = document.getElementById('current-month');
                this.prevMonthBtn = document.getElementById('prev-month');
                this.nextMonthBtn = document.getElementById('next-month');
                this.calendarGrid = document.getElementById('calendar-grid');
                
                // Stats elements
                this.monthCompleted = document.getElementById('month-completed');
                this.monthStreak = document.getElementById('month-streak');
                this.monthPercentage = document.getElementById('month-percentage');
                
                // Quote elements
                this.quoteText = document.getElementById('quote-text');
                this.quoteAuthor = document.getElementById('quote-author');
            }

            setupEventListeners() {
                // Date navigation
                this.prevDayBtn.addEventListener('click', () => this.changeDate(-1));
                this.nextDayBtn.addEventListener('click', () => this.changeDate(1));
                
                // Task management
                this.addTaskBtn.addEventListener('click', () => this.addTask());
                this.taskInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addTask();
                });
                this.clearCompletedBtn.addEventListener('click', () => this.clearCompletedTasks());
                
                // Habit management
                this.addHabitBtn.addEventListener('click', () => this.addHabit());
                this.habitInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addHabit();
                });
                this.resetHabitsBtn.addEventListener('click', () => this.resetTodayHabits());
                
                // Calendar navigation
                this.prevMonthBtn.addEventListener('click', () => this.changeMonth(-1));
                this.nextMonthBtn.addEventListener('click', () => this.changeMonth(1));
            }

            setupThemeSelector() {
                const themeButtons = document.querySelectorAll('.theme-btn');
                themeButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const theme = e.currentTarget.dataset.theme;
                        this.changeTheme(theme);
                        
                        themeButtons.forEach(b => b.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                    });
                });
            }

            changeTheme(theme) {
                document.body.className = theme;
            }

            // Date management
            changeDate(days) {
                this.currentDate.setDate(this.currentDate.getDate() + days);
                this.render();
            }

            changeMonth(months) {
                this.currentDate.setMonth(this.currentDate.getMonth() + months);
                this.renderCalendar();
            }

            getDateKey(date = this.currentDate) {
                return date.toISOString().split('T')[0];
            }

            // Data management methods
            loadData(key) {
                try {
                    const data = localStorage.getItem(`planner_${key}`);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error('Error loading data:', error);
                    return null;
                }
            }

            saveData(key, data) {
                try {
                    localStorage.setItem(`planner_${key}`, JSON.stringify(data));
                } catch (error) {
                    console.error('Error saving data:', error);
                }
            }

            // Task management
            addTask() {
                const text = this.taskInput.value.trim();
                if (!text) return;

                const dateKey = this.getDateKey();
                if (!this.tasks[dateKey]) {
                    this.tasks[dateKey] = [];
                }

                this.tasks[dateKey].push({
                    id: Date.now(),
                    text: text,
                    completed: false,
                    createdAt: new Date()
                });

                this.taskInput.value = '';
                this.saveData('tasks', this.tasks);
                this.renderTasks();
            }

            toggleTask(taskId) {
                const dateKey = this.getDateKey();
                const task = this.tasks[dateKey]?.find(t => t.id === taskId);
                if (task) {
                    task.completed = !task.completed;
                    this.saveData('tasks', this.tasks);
                    this.renderTasks();
                }
            }

            deleteTask(taskId) {
                const dateKey = this.getDateKey();
                this.tasks[dateKey] = this.tasks[dateKey]?.filter(t => t.id !== taskId) || [];
                this.saveData('tasks', this.tasks);
                this.renderTasks();
            }

            clearCompletedTasks() {
                const dateKey = this.getDateKey();
                if (this.tasks[dateKey]) {
                    this.tasks[dateKey] = this.tasks[dateKey].filter(t => !t.completed);
                    this.saveData('tasks', this.tasks);
                    this.renderTasks();
                }
            }

            // Habit management
            addHabit() {
                const text = this.habitInput.value.trim();
                if (!text) return;

                this.habits.push({
                    id: Date.now(),
                    text: text,
                    createdAt: new Date()
                });

                this.habitInput.value = '';
                this.saveData('habits', this.habits);
                this.renderHabits();
            }

            toggleHabit(habitId) {
                const dateKey = this.getDateKey();
                if (!this.habitHistory[dateKey]) {
                    this.habitHistory[dateKey] = [];
                }

                const habitIndex = this.habitHistory[dateKey].indexOf(habitId);
                if (habitIndex > -1) {
                    this.habitHistory[dateKey].splice(habitIndex, 1);
                } else {
                    this.habitHistory[dateKey].push(habitId);
                }

                this.saveData('habitHistory', this.habitHistory);
                this.renderHabits();
                this.calculateStreak();
            }

            deleteHabit(habitId) {
                this.habits = this.habits.filter(h => h.id !== habitId);
                
                Object.keys(this.habitHistory).forEach(date => {
                    this.habitHistory[date] = this.habitHistory[date].filter(id => id !== habitId);
                });

                this.saveData('habits', this.habits);
                this.saveData('habitHistory', this.habitHistory);
                this.renderHabits();
            }

            resetTodayHabits() {
                const dateKey = this.getDateKey();
                this.habitHistory[dateKey] = [];
                this.saveData('habitHistory', this.habitHistory);
                this.renderHabits();
                this.calculateStreak();
            }

            // Fixed streak calculation
            calculateStreak() {
                let streak = 0;
                const today = new Date();
                const todayKey = this.getDateKey(today);
                
                // Check if today's habits are completed
                const todayHabitsCompleted = this.habitHistory[todayKey] || [];
                const hasCompletedToday = todayHabitsCompleted.length > 0 && this.habits.length > 0;
                
                if (hasCompletedToday) {
                    streak = 1;
                    
                    // Check previous days
                    for (let i = 1; i < 365; i++) {
                        const checkDate = new Date(today);
                        checkDate.setDate(today.getDate() - i);
                        const dateKey = this.getDateKey(checkDate);
                        
                        const completedHabits = this.habitHistory[dateKey] || [];
                        const hasCompleted = completedHabits.length > 0 && this.habits.length > 0;
                        
                        if (hasCompleted) {
                            streak++;
                        } else {
                            break;
                        }
                    }
                } else {
                    // Check consecutive days before today
                    for (let i = 1; i < 365; i++) {
                        const checkDate = new Date(today);
                        checkDate.setDate(today.getDate() - i);
                        const dateKey = this.getDateKey(checkDate);
                        
                        const completedHabits = this.habitHistory[dateKey] || [];
                        const hasCompleted = completedHabits.length > 0 && this.habits.length > 0;
                        
                        if (hasCompleted) {
                            streak++;
                        } else {
                            break;
                        }
                    }
                }
                
                this.streakCount.textContent = streak;
                return streak;
            }

            calculateMonthlyStats() {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();
                const lastDay = new Date(year, month + 1, 0);
                
                let completedTasks = 0;
                let totalTasks = 0;
                let bestStreak = 0;
                let currentStreak = 0;
                
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    const date = new Date(year, month, day);
                    const dateKey = this.getDateKey(date);
                    const dailyTasks = this.tasks[dateKey] || [];
                    
                    totalTasks += dailyTasks.length;
                    completedTasks += dailyTasks.filter(t => t.completed).length;
                    
                    const completedHabits = this.habitHistory[dateKey] || [];
                    const hasCompletedHabits = completedHabits.length > 0 && this.habits.length > 0;
                    
                    if (hasCompletedHabits) {
                        currentStreak++;
                        bestStreak = Math.max(bestStreak, currentStreak);
                    } else {
                        currentStreak = 0;
                    }
                }
                
                const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
                
                this.monthCompleted.textContent = completedTasks;
                this.monthStreak.textContent = bestStreak;
                this.monthPercentage.textContent = `${completionRate}%`;
            }

            // Rendering methods
            render() {
                this.renderDate();
                this.renderTasks();
                this.renderHabits();
                this.renderCalendar();
                this.calculateStreak();
                this.calculateMonthlyStats();
            }

            renderDate() {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                this.currentDateEl.textContent = this.currentDate.toLocaleDateString('en-US', options);
            }

            renderTasks() {
                const dateKey = this.getDateKey();
                const dailyTasks = this.tasks[dateKey] || [];
                
                this.taskList.innerHTML = '';
                
                dailyTasks.forEach(task => {
                    const li = document.createElement('li');
                    li.className = `task-item ${task.completed ? 'completed' : ''}`;
                    li.innerHTML = `
                        <input type="checkbox" ${task.completed ? 'checked' : ''}>
                        <span>${this.escapeHtml(task.text)}</span>
                        <button class="delete-btn" title="Delete task">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    
                    li.querySelector('input').addEventListener('change', () => this.toggleTask(task.id));
                    li.querySelector('.delete-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.deleteTask(task.id);
                    });
                    
                    this.taskList.appendChild(li);
                });
                
                const completedTasks = dailyTasks.filter(t => t.completed).length;
                this.taskCount.textContent = dailyTasks.length;
                this.completedCount.textContent = completedTasks;
                this.pendingCount.textContent = dailyTasks.length - completedTasks;
            }

            renderHabits() {
                const dateKey = this.getDateKey();
                const completedHabits = this.habitHistory[dateKey] || [];
                
                this.habitList.innerHTML = '';
                
                this.habits.forEach(habit => {
                    const isChecked = completedHabits.includes(habit.id);
                    const li = document.createElement('li');
                    li.className = `habit-item ${isChecked ? 'checked' : ''}`;
                    li.innerHTML = `
                        <input type="checkbox" ${isChecked ? 'checked' : ''}>
                        <span>${this.escapeHtml(habit.text)}</span>
                        <button class="delete-btn" title="Delete habit">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    
                    li.querySelector('input').addEventListener('change', () => this.toggleHabit(habit.id));
                    li.querySelector('.delete-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.deleteHabit(habit.id);
                    });
                    
                    this.habitList.appendChild(li);
                });
                
                this.habitsCompleted.textContent = completedHabits.length;
                this.habitsTotal.textContent = this.habits.length;
            }

            renderCalendar() {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();
                
                this.currentMonthEl.textContent = this.currentDate.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long' 
                });
                
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDay = firstDay.getDay();
                
                this.calendarGrid.innerHTML = '';
                
                ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                    const dayEl = document.createElement('div');
                    dayEl.className = 'calendar-day header';
                    dayEl.textContent = day;
                    this.calendarGrid.appendChild(dayEl);
                });
                
                for (let i = 0; i < startingDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day other-month';
                    this.calendarGrid.appendChild(emptyDay);
                }
                
                const today = new Date();
                const todayKey = this.getDateKey(today);
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month, day);
                    const dateKey = this.getDateKey(date);
                    
                    const dayEl = document.createElement('div');
                    dayEl.className = 'calendar-day';
                    dayEl.textContent = day;
                    
                    if (dateKey === todayKey) {
                        dayEl.classList.add('today');
                    }
                    
                    if (this.tasks[dateKey] && this.tasks[dateKey].length > 0) {
                        dayEl.classList.add('has-tasks');
                    }
                    
                    dayEl.addEventListener('click', () => {
                        this.currentDate = date;
                        this.render();
                    });
                    
                    this.calendarGrid.appendChild(dayEl);
                }
            }

            // Utility methods
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            getMotivationalQuotes() {
                return [
                    { text: "The secret of getting ahead is getting started.", author: "Mark Twain" },
                    { text: "It's not whether you get knocked down, it's whether you get up.", author: "Vince Lombardi" },
                    { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
                    { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
                    { text: "The future depends on what you do today.", author: "Mahatma Gandhi" }
                ];
            }

            showRandomQuote() {
                const randomQuote = this.quotes[Math.floor(Math.random() * this.quotes.length)];
                this.quoteText.textContent = `"${randomQuote.text}"`;
                this.quoteAuthor.textContent = `- ${randomQuote.author}`;
            }
        }

        // Initialize the planner when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new SmartPlanner();
        });
    </script>
</body>
</html>